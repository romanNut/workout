<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Streetlifting Journal</title>
    <style>
        :root { --primary: #3498db; --bg: #f4f7f6; --card: #ffffff; --accent: #e74c3c; --sync: #2ecc71; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 50px; }
        .container { max-width: 600px; margin: 0 auto; }
        .sync-status { text-align: center; font-size: 11px; margin-bottom: 5px; color: #7f8c8d; }
        .sync-status.loading { color: #f39c12; }
        .sync-status.ready { color: var(--sync); }
        .tabs { display: flex; overflow-x: auto; gap: 5px; margin-bottom: 15px; position: sticky; top: 0; background: var(--bg); padding: 5px 0; z-index: 100; }
        .tab-btn { flex: 1; border: none; padding: 12px 8px; cursor: pointer; border-radius: 8px; font-weight: bold; font-size: 12px; background: #ddd; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: white; }
        .week-content { display: none; }
        .week-content.active { display: block; }
        .day-card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-top: 4px solid var(--primary); }
        .day-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; margin-bottom: 10px; padding-bottom: 5px; }
        .day-header h3 { margin: 0; color: var(--primary); font-size: 18px; }
        .exercise-block { margin-bottom: 12px; padding: 10px; background: #f9f9f9; border-radius: 8px; }
        .ex-title { font-weight: bold; font-size: 14px; display: block; margin-bottom: 5px; color: #333; }
        .set-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .set-num { font-size: 11px; min-width: 15px; color: #888; font-weight: bold; }
        input { padding: 8px 5px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; text-align: center; }
        .input-w { width: 55px; background: #fff5f5; color: #e74c3c; font-weight: bold; }
        .input-r { width: 50px; }
        input[type="checkbox"] { width: 24px; height: 24px; cursor: pointer; margin-left: auto; }
        ::placeholder { color: #bbb; font-weight: normal; font-size: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="status" class="sync-status">Облако: инициализация...</div>
    <h1>☁️ Streetlifting Cloud</h1>
    
    <div class="tabs" id="tabBar">
        <button class="tab-btn active" onclick="showWeek(1)">Неделя 1</button>
        <button class="tab-btn" onclick="showWeek(2)">Неделя 2</button>
        <button class="tab-btn" onclick="showWeek(3)">Неделя 3</button>
        <button class="tab-btn" onclick="showWeek(4)">Неделя 4</button>
    </div>

    <div id="content"></div>
</div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby0THLk5N23Qm8n-aGcudKw0YmgeLzJ8KKeY9KPeM0YQiqlmLbLw_uFmygB4CCHKU1U/exec'; // <--- ВСТАВЬ ССЫЛКУ СЮДА
    
    const weeks = [
        { id: 1, title: "Вработка (5х12)", weights: { d: "30", p: "15", ld: "20", lp: "10" }, reps: "12" },
        { id: 2, title: "Объем (5х15)", weights: { d: "30", p: "15", ld: "20", lp: "10" }, reps: "15" },
        { id: 3, title: "Пик (+5кг)", weights: { d: "35", p: "20", ld: "20", lp: "10" }, reps: "12" },
        { id: 4, title: "Разгрузка", weights: { d: "30", p: "15", ld: "0", lp: "0" }, reps: "10" }
    ];

    // Отрисовка структуры
    function generateContent() {
        const container = document.getElementById('content');
        weeks.forEach(w => {
            const weekDiv = document.createElement('div');
            weekDiv.id = `week${w.id}`;
            weekDiv.className = `week-content ${w.id === 1 ? 'active' : ''}`;
            const days = [
                { name: "Вторник", t: "Тяж", s: w.id===4?2:5, r: w.reps, wd: w.weights.d, wp: w.weights.p },
                { name: "Четверг", t: "Лег", s: 3, r: "10", wd: w.weights.ld, wp: w.weights.lp, note: "(3с пауза)" },
                { name: "Суббота", t: "Тяж", s: w.id===4?2:5, r: w.reps, wd: w.weights.d, wp: w.weights.p }
            ];
            weekDiv.innerHTML = `<div style="text-align:center; padding:10px; color:#666;"><b>${w.title}</b></div>`;
            days.forEach(day => {
                weekDiv.innerHTML += `
                    <div class="day-card">
                        <div class="day-header"><h3>${day.name}</h3><span style="font-size:11px;">${day.t}</span></div>
                        <div class="exercise-block">
                            <span class="ex-title">1. Стойка + Выходы</span>
                            <input type="text" id="w${w.id}${day.name}n" style="width:95%" placeholder="Заметки...">
                        </div>
                        <div class="exercise-block">
                            <span class="ex-title">2. Брусья ${day.note || ''}</span>
                            ${generateSets(w.id, day.name, "d", day.s, day.wd, day.r)}
                        </div>
                        <div class="exercise-block">
                            <span class="ex-title">3. Турник ${day.note || ''}</span>
                            ${generateSets(w.id, day.name, "p", day.s, day.wp, day.r)}
                        </div>
                        <div class="exercise-block" style="display:flex; align-items:center;">
                            <span class="ex-title" style="margin:0;">4. Осанка</span>
                            <input type="checkbox" id="w${w.id}${day.name}c">
                        </div>
                    </div>`;
            });
            container.appendChild(weekDiv);
        });
        loadFromCloud();
    }

    function generateSets(wId, day, type, count, tw, tr) {
        let h = '';
        for(let i=1; i<=count; i++) {
            let id = `w${wId}${day}${type}${i}`;
            h += `<div class="set-row">
                <span class="set-num">${i}</span>
                <input type="number" class="input-w" id="${id}_w" placeholder="${tw}">
                <input type="number" class="input-r" id="${id}_r" placeholder="${tr}">
                <input type="checkbox" id="${id}_c">
            </div>`;
        }
        return h;
    }

    function showWeek(n) {
        document.querySelectorAll('.week-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`week${n}`).classList.add('active');
        document.querySelectorAll('.tab-btn')[n-1].classList.add('active');
    }

    // ОБЛАЧНАЯ СИНХРОНИЗАЦИЯ
    async function saveToCloud(id, value) {
        document.getElementById('status').innerText = 'Облако: сохранение...';
        document.getElementById('status').className = 'sync-status loading';
        const data = {}; data[id] = value;
        try {
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) });
            document.getElementById('status').innerText = 'Облако: синхронизировано';
            document.getElementById('status').className = 'sync-status ready';
        } catch(e) { document.getElementById('status').innerText = 'Ошибка сети'; }
    }

    async function loadFromCloud() {
        document.getElementById('status').innerText = 'Облако: загрузка...';
        try {
            const resp = await fetch(SCRIPT_URL);
            const data = await resp.json();
            for (let id in data) {
                const el = document.getElementById(id);
                if (el) {
                    if (el.type === 'checkbox') el.checked = (data[id] === true || data[id] === 'true');
                    else el.value = data[id];
                }
            }
            document.getElementById('status').innerText = 'Облако: данные актуальны';
            document.getElementById('status').className = 'sync-status ready';
        } catch(e) { document.getElementById('status').innerText = 'Автономный режим'; }
    }

    document.addEventListener('change', (e) => {
        if (e.target.id) {
            const val = e.target.type === 'checkbox' ? e.target.checked : e.target.value;
            saveToCloud(e.target.id, val);
        }
    });

    generateContent();
</script>
</body>
</html>